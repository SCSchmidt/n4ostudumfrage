---
title: "Evaluation of the NFDI4Objects survey for students and trainees"
author:
  - Sophie C. Schmidt:
      email: sophie.schmidt@dainst.de
      institute: [DAI]
      correspondence: true
  - Christin Keller:
      email: christin.keller@dainst.de
      institute: [DAI]
      correspondence: false
  - Louise Rokohl:
      email: rokohl@rgzm.de
      institute: [RGZM]
      correspondence: false
  - Florian Thiery:
      email: thiery@rgzm.de
      institute: [RGZM]
      correspondence: false
  - Henrike Backhaus:
      email: henrike.backhaus@hs-mainz.de
      institute: [HSM]
      correspondence: false 
institute:
  - DAI: Deutsches Archäologisches Institut
  - RGZM: Römisch-Germanisches Zentralmuseum Mainz
  - HSM: Hochschule Mainz
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  NFDI, survey, results, research data management
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Introduction
This paper gives a quick overview over the results of the NFDI4Objects survey, that was tailored to students and trainees.

We were especially interested in what kind of courses on research data management or related topics have been offered to students and trainees and how they gathered the skills they need for their work.

# data set

```{r data}

d <- read.csv2("../data/raw_data/20201210_results-survey553894.csv", sep = ",", encoding = "UTF-8")

library(tidyr)
library(dplyr)
library(tidyverse)

d <- d %>%
  rename(Archaeologie = studienfach.SQ001.,
        Anthropologie = studienfach.SQ002.,
        Archaeozoologie =  studienfach.SQ003.,
        Archaeobotanik =  studienfach.SQ004.,
        Architektur.Bauforschung =  studienfach.SQ005.,
        Digital.Humanities = studienfach.SQ006.,
        Geschichtswissenschaften = studienfach.SQ007.,
        Grabungstechnik = studienfach.SQ008.,
        Klimaforschung = studienfach.SQ009.,
        Konservierung = studienfach.SQ010.,
        Kunstgeschichte =  studienfach.SQ011.,
        Linguistik.Philologie = studienfach.SQ012.,
        MINT = studienfach.SQ013.,
        Museumswissenschaften = studienfach.SQ014.,
        Musikwissenschaften = studienfach.SQ015.,
        Geochemie = studienfach.SQ016.,
        Geologie = studienfach.SQ017.,
        Geographie = studienfach.SQ018.,
        Restaurierung = studienfach.SQ019.)


d <- d %>%
  rename(Interesse.1 = warumkurs1.SQ001.,
         Pflichtveranstaltung.1 = warumkurs1.SQ002.,
         hilfreich.1 = warumkurs1.SQ003.,
         Arbeitsmarkt.1 = warumkurs1.SQ004.,
         Interesse.2 = warumkurs2.SQ001.,
         Pflichtveranstaltung.2 = warumkurs2.SQ002.,
         hilfreich.2 = warumkurs2.SQ003.,
         Arbeitsmarkt.2 = warumkurs2.SQ004.,
         Interesse.3 = warumkurs3.SQ001.,
         Pflichtveranstaltung.3 = warumkurs3.SQ002.,
         hilfreich.3 = warumkurs3.SQ003.,
         Arbeitsmarkt.3 = warumkurs3.SQ004.)

# remove "" as input and make NA out of it
# dplyr solution fom here: https://stackoverflow.com/questions/24172111/change-the-blank-cells-to-na

library(dplyr)

empty_as_na <- function(x){
    if("factor" %in% class(x)) x <- as.character(x) ## since ifelse wont work with factors
    ifelse(as.character(x)!="", x, NA)
}

## transform all columns
d <- d %>% 
  mutate_each(funs(empty_as_na))


```


how many respondents: in total `r nrow(d)` number of answers

## demographics of respondents

### age

```{r age}
library(ggplot2)

sum_alter  <- summary(d$alter)

ggplot(data = d)+
  geom_histogram(aes(x = alter), binwidth = 1)+
  xlab("age")+
  geom_text(aes(x = 65, y = 20, label = paste("n =", nrow(d))))+
  geom_text(aes(x = 65, y = 10, label = paste("NA's = ", sum_alter[7])))



```

Most of the respondents are aged between `r sum_alter[2]` (first quartile) and `r sum_alter[5]` (third quartile) years old. The youngest person is `r sum_alter[1]` and the oldest `r sum_alter[6]`. Median age is `r sum_alter[3]` and mean age is `r sum_alter[4]`. We can therfore conclude that we were able to reach the group of 20-29 year olds which was our aim. 

### type of training


```{r training}

ggplot(data = d, aes(x = artausbildung, fill = artausbildung))+
  geom_bar()+
  geom_text(stat='count', aes(label = after_stat(count)), hjust=-0.01)+
  labs(x = "type of training")+
  guides(fill = FALSE)+
  coord_flip()
```

### subject of studies

```{r, faecher_data}


faecher <-  d %>%
  pivot_longer(c(Archaeologie:studienfach.other.),
             names_to = "fach",
             values_to = "ja",
             values_drop_na = FALSE) %>%
  filter(ja != "Nein" &  ja != "N/A")

faecher$fach <- ifelse(faecher$fach == "studienfach.other.", faecher$ja, faecher$fach)

```

```{r, faecher_textmining_all}


tab_fach <- as.data.frame(table(faecher$fach))

write.csv2(tab_fach, "../data/derived_data/faecheraufstellung.csv", fileEncoding = "UTF-8")

  # text mining "sonstige" für Fächer
  
library("tm")
library("SnowballC")

  # bwl und betriebswirtschaftslehre zusammenfügen, bibliotheks und informationswissenschaft, journalisitik und journalismus zusammenfügen
d$studienfach.other.  <- gsub("bwl", "betriebswirtschaftslehre", d$studienfach.other.)
d$studienfach.other.  <- gsub("bibliotheks", "bibliothekswissenschaften", d$studienfach.other.)
d$studienfach.other.  <- gsub("journalistik", "journalismus", d$studienfach.other.)

docs <- Corpus(VectorSource(d$studienfach.other.))

#inspect(docs)

# Remove punctuations
#docs <- tm_map(docs, removePunctuation)

# Eliminate extra white spaces
docs <- tm_map(docs, stripWhitespace)

# Text stemming
# docs <- tm_map(docs, stemDocument)
docs <- tm_map(docs, removeWords, stopwords("german"))

# Document matrix is a table containing the frequency of the words. 
# Column names are words and row names are documents. 
# The function TermDocumentMatrix() from text mining package can be used as follow :
dtm <- TermDocumentMatrix(docs)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
studienfach_sonst <- data.frame(word = names(v),freq=v)
head(studienfach_sonst, 30)

## to do! 
# soziale arbeit wieder zusammenfügen,
# informatik zu mint, archäoinformatik zu DH?
# antike kulturen vorderasiens und ägyptens?

# bauforschung?

colnames(studienfach_sonst)  <- c("Var1", "Freq")

studfach_alle  <- rbind(tab_fach, studienfach_sonst)

studfach_alle <- studfach_alle[!studfach_alle$Var1 == "arbeit",]
#studfach_alle$Var1[studfach_alle$Var1 == "soziale"] <- "soziale arbeit"
studfach_alle <- studfach_alle[!studfach_alle$Var1 == "relations",]

studfach_alle$Var1 <- recode(studfach_alle$Var1,
                                      soziale = "Soziale Arbeit",
                             public = "public relations")



studfach_alle %>%
 # filter(Freq > 2) %>%
  ggplot()+
  geom_bar(aes(x = reorder(Var1, Freq), y = Freq), stat = "identity")+
  labs(x = "subjects", 
     #  y = "frequency (> 2)", 
       name = "Main subject of respondent")+
    coord_flip()

```

## Bereinigung des Datensatzes

```{r}

# Liste der Fächer, die wir bei uns sehen:

community <- c("Archaeologie", "Digital Humanities", "Museumswissenschaften", "Anthropologie", "Grabungstechnik", "Architektur.Bauforschung", "Geographie", "Ägyptologie", "Ethnologie", "Restaurierung", "Denkmalpflege", "Archäoinformatik", "wissenschaftliche Ausstellungserarbeitung", "Angewandte Informatik", "Bibliotheks- und Informationwissenschaft",  "Kulturanthropologie", "Klimaforschung", "Numismatik", "Geophysik", "Antike Kulturen Vorderasiens und Ägyptens ", "Antike Kulturen Ägyptens und Vorderasiens ", "Bibliotheksreferendariat", "Prähistorische und Historische Archäologie", "Digitale Denkmaltechnologien (Baufoschung, MINT, Bauingenieurwesen, Heritage,...)", "Altamerikanistik/ Ethnologie", "Altertumswissenschaften", "Ethnologie und Erziehungswissenschaften", "Bibliothekswissenschaft", "Bibliotheksreferendariat mit Master Bibliotheks- und Informationswissenschaft", "Informationswissenschaften", "Informationsmanagement", "Organische Residuenanalysen", )


faecher2 <- subset(faecher, faecher$fach %in% community)

```



# which year of studies

```{r ausbildung}

ggplot(data = d)+
  geom_histogram(aes(x = jahrausbildung, fill =  artausbildung, col = artausbildung), alpha = 0.3)

```


### gender

```{r gender}

gender <- as.data.frame(table(d$geschlecht))
gender$Freq[gender$Var1 == "keine Angabe"] <- gender$Freq[gender$Var1 == "keine Angabe"] + gender$Freq[gender$Var1 == ""]
gender <- gender[-(gender$Var1 == ""),]

ggplot(data = gender, aes(x = reorder(Var1, -Freq), y = Freq))+
  geom_bar(stat = "identity" )+
    labs(x = "gender", 
       y = "frequency", 
       name = "Gender of respondent")+
    geom_text(aes(label = Freq), hjust = 0.5)+
theme_bw()
```

### institution

```{r inst}

inst  <- as.data.frame(table(d$institution))

inst$Var1[inst$Var1 == ""] <- NA

ggplot(data = inst, aes(x = reorder(Var1, -Freq), y = Freq))+
  geom_bar(stat = "identity")+    
  geom_text(aes(label = Freq), hjust = 0.5)+
  coord_flip()


```



## 1. Welche Kurse wurden bereits belegt?

```{r fdmkursejanein}
fdm_ja <- d %>%
  subset(fdmkursejanein == "ja") %>%
  nrow()

fdm_nein <- d %>%
  subset(fdmkursejanein == "nein") %>%
  nrow()
fdm_wn <- d %>%
  subset(fdmkursejanein == "weiß ich nicht") %>%
  nrow()
```

Students were asked to say, whether there are courses at their institution which touched on research data management. Of those that answered `r fdm_ja` answered yes, `r fdm_nein` said "no". Most (`r fdm_wn`) were not sure, suggesting there were no courses in their immediate environmenht or they were unsure, what research data management entailed. 

```{r}
kursja <- d %>%
  filter(Kurswahrgenommenjane == "ja") %>%
  nrow()

kursnein <- d %>%
  filter(Kurswahrgenommenjane == "nein") %>%
  nrow()

ggplot()+
  geom_bar(data = d, aes(x = Kurswahrgenommenjane))
```
Next, students were asked, whether they had joined a course on data management. Here we can see that most (`r kursnein`) didn't, but `r kursja` did.

Those who had visited some courses were asked to name the amount of courses they visited at their institution which touched on data management.

```{r nkurse_fdm}
sum_nkurse <- summary(d$nkurse)

ggplot()+
  geom_histogram(data = d, aes(x = nkurse))

```
Most of the respondents, who said they had already taken a course on data management, named between `r sum_nkurse[2]` (first quartile) and `r sum_nkurse[5]` (third quartile) courses. The median is `r sum_nkurse[3]` and mean is `r sum_nkurse[4]`. The maximal value of `r sum_nkurse[6]` is a clear outlier.

## 2. ist das abhängig von dem Fach, welches studiert wird?

Next we look at how these data change in response to the studied subject.

```{r}

kurs_fach <- as.data.frame(table(faecher$fach, faecher$Kurswahrgenommenjane))

ggplot()+
  geom_col(data = kurs_fach, aes(x = reorder(Var1, Freq), y = Freq, fill = Var2))+
  coord_flip()
```



```{r}
ggplot()+
  geom_histogram(data = faecher, aes(x = nkurse, fill = fach))
```

Outlier: MINT-subjects. In most other subjects: A lot of ppl took one course, and then it gradually gets less and less.


```{r no_courses_subject}
library(kableExtra)
table(faecher$fach, faecher$nkurse) %>%
  kable()
```


## 3. Was für Kurse wurden bereits besucht?

Respondents were asked to give the details of up to three courses they already took.

```{r}

#umofrmung der daten: kursbeschreibung gibt thema, kursfach, in welchem fach das angeboten wurde, bundsland,

d_kurs1 <- d %>% 
  pivot_longer(kursbeschreibung1.3D.:kursbeschreibung1.other., # fasse diese zusammen
               names_to = "kurs1", # in dieser neuen spalte 
               names_prefix = "kursbeschreibung1.", #lösch diesen prefix
               values_to = "kurs1ja", # ja oder nein in diese spalte
               values_drop_na = TRUE)%>% # lösch alle NA
  filter(kurs1ja != "Nein" & kurs1ja != "N/A" & kurs1ja != "")%>% # filter auf die die "ja" haben
  pivot_longer(Interesse.1:warumkurs1.other.,
               names_to = "warum1",
               values_to = "warum1ja",
               values_drop_na = TRUE)%>%
  filter(warum1ja == "Ja")

ggplot(data = d_kurs1)+
  geom_bar(aes(x = kurs1, fill = warum1))+
  coord_flip()

```

```{r}
# umformung daten kurs zwei

d_kurs2 <- d %>% 
  pivot_longer(kursbeschreibung2.3D.:kursbeschreibung2.other., # fasse diese zusammen
               names_to = "kurs2", # in dieser neuen spalte 
               names_prefix = "kursbeschreibung2.", #lösch diesen prefix
               values_to = "kurs2ja", # ja oder nein in diese spalte
               values_drop_na = TRUE)%>% # lösch alle NA
  filter(kurs2ja != "Nein" & kurs2ja != "N/A" & kurs2ja != "")%>% # filter auf die die "ja" haben
  pivot_longer(Interesse.2:warumkurs2.other.,
               names_to = "warum2",
               values_to = "warum2ja",
               values_drop_na = TRUE)%>%
  filter(warum2ja == "Ja")

ggplot(data = d_kurs2)+
  geom_bar(aes(x = kurs2, fill = warum2))+
  coord_flip()

```

```{r}
d_kurs3 <- d %>% 
  pivot_longer(kursbeschreibung3.3D.:kursbeschreibung3.other., # fasse diese zusammen
               names_to = "kurs3", # in dieser neuen spalte 
               names_prefix = "kursbeschreibung3.", #lösch diesen prefix
               values_to = "kurs3ja", # ja oder nein in diese spalte
               values_drop_na = TRUE)%>% # lösch alle NA
  filter(kurs3ja != "Nein" & kurs3ja != "N/A" & kurs3ja != "")%>% # filter auf die die "ja" haben
  pivot_longer(Interesse.3:warumkurs3.other.,
               names_to = "warum3",
               values_to = "warum3ja",
               values_drop_na = TRUE)%>%
  filter(warum3ja == "Ja")

ggplot(data = d_kurs3)+
  geom_bar(aes(x = kurs3, fill = warum3))+
  coord_flip()
```

```{r}
# Zusammmenfassung kurs 1-3

d_kurs1 <- d_kurs1 %>%
  rename(kurs_institution = kurs1,
         kursja = kurs1ja,
         grund = warum1,
         grundja = warum1ja,
         fach = kursfach1,
         fach.other = kursfach1.other.,
         bundesland = bundesland1,
         bundesland.other = bundesland1.other.,
         kursjahr = kursjahr1,
         kurspflicht = kurspflicht1,
         kursquali1 = kursquali1.SQ001.,
         kurs_umsetzen = kursquali1.SQ002.)

d_kurs2 <- d_kurs2 %>%
  rename(kurs_institution = kurs2,
         kursja = kurs2ja,
         grund = warum2,
         grundja = warum2ja,
         fach = fach2,
         fach.other = fach2.other.,
         bundesland = bundesland2,
         bundesland.other = bundesland2.other.,
         kursjahr = kursjahr2,
         kurspflicht = kurspflicht2,
         kursquali1 = kursquali2.SQ001.,
         kurs_umsetzen = kursquali2.SQ002.)

d_kurs3 <- d_kurs3 %>%
  rename(kurs_institution = kurs3,
         kursja = kurs3ja,
         grund = warum3,
         grundja = warum3ja,
         fach = fach3,
         fach.other = fach3.other.,
         bundesland = bundesland3,
         bundesland.other = bundesland3.other.,
         kursjahr = kursjahr3,
         kurspflicht = kurspflicht3,
         kursquali1 = kursquali3.SQ001.,
         kurs_umsetzen = kursquali3.SQ002.)

common_cols <- intersect(colnames(d_kurs1), colnames(d_kurs2))
common_cols2 <- intersect(colnames(d_kurs2), colnames(d_kurs3))

common_cols <- intersect(common_cols, common_cols2)

d_kurs_inst <- rbind(
  subset(d_kurs1, select = common_cols), 
  subset(d_kurs2, select = common_cols),
  subset(d_kurs3, select = common_cols) )

d_kurs_inst$grund <- gsub('.[0-9]+', '', d_kurs_inst$grund)

```
### all courses taken on institutions of repsondents

#### looking at reason for attending

```{r inst_kurse_grund}
ggplot(data = d_kurs_inst)+
  geom_bar(aes(x = kurs_institution, fill = grund))+
  coord_flip()
```


#### looking at bundesland


```{r inst_kurse_bund }
ggplot(data = d_kurs_inst)+
  geom_bar(aes(x = bundesland , fill = kurs_institution ))+
  coord_flip()
```

Gibt es Unterschiede zwischen den Bundesländern?

#### date of course taken

```{r}

kurs_inst_jahr <- as.data.frame(table(d_kurs_inst$kursjahr, d_kurs_inst$bundesland))

kurs_inst_jahr %>%
  filter(!is.na(Var2) & Var2 != "")%>%
ggplot(aes(x = Var1, col = Var2, y = Freq))+
  geom_point() +
  geom_line(aes(group = Var2))+
  theme_minimal()+
  labs(x = "Jahr", y = "Anzahl", title = "Anzahl Kurse mit FDM-Bezug pro Jahr")

ggsave("../figures/first_draft_jahr_kurs.png", dpi = 300, units = "cm", height = 10)

## notiz: das nicht anzahl kurse sondern anzahl themen in kursen!! 
```


4. Suchen sich Leute Kurse aus anderen Fächern oder nur in dem eigenen?

5. Wie viele Kurse werden im Schnitt besucht?

6. Warum werde Kurse besucht?
  6a abhängig von studiertem Fach?
  6b abhängig von Thema des Kurses?
  
7. Umgang mit Daten?
  7a Such- und Findeverhalten, 
  7b Welche back-up Strategien werden benutzt

8. Gehen Leute in Fortbildungen? 
  8a zu welchen Themen?

9. Bilden sich Leute selber fort?
  9a zu welchen Themen?

10. Warum werden Kurse nicht besucht?

11. Hängen Besuch von Kursen und Fortbildungen, Richtlinien zu FDM sowie Wissen um NFDI und Metadaten von ITAffinität ab? 

12. In welchem Bereich bestehen Wünsche zu Fortbildung?

\newpage

# References 

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
